<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>picotm: picotm/picotm-lib-shared-treemap.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_4eaf8f6a41a8424231482edc717c057f.html">picotm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">picotm-lib-shared-treemap.h File Reference<div class="ingroups"><a class="el" href="../../dc/d55/a00226.html">The Module Helper Library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains <code>struct <a class="el" href="../../dd/d86/a00271.html" title="Maps keys to values. ">picotm_shared_treemap</a></code> and helper functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdatomic.h&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d0/dc2/a00104.html">stdint.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="../../dd/dad/a00005.html">compiler.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d86/a00271.html">picotm_shared_treemap</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps keys to values.  <a href="../../dd/d86/a00271.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga1089f2dc42155ad95e7347fc1434c4d8"><td class="memItemLeft" align="right" valign="top">typedef uintptr_t(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d55/a00226.html#ga1089f2dc42155ad95e7347fc1434c4d8">picotm_shared_treemap_value_create_function</a>) (unsigned long long key, struct <a class="el" href="../../dd/d86/a00271.html">picotm_shared_treemap</a> *treemap, struct <a class="el" href="../../d6/d82/a00243.html">picotm_error</a> *error)</td></tr>
<tr class="separator:ga1089f2dc42155ad95e7347fc1434c4d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga818c239b617f13c2fb358c0217350c4d"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d55/a00226.html#ga818c239b617f13c2fb358c0217350c4d">picotm_shared_treemap_value_destroy_function</a>) (uintptr_t value, struct <a class="el" href="../../dd/d86/a00271.html">picotm_shared_treemap</a> *treemap)</td></tr>
<tr class="separator:ga818c239b617f13c2fb358c0217350c4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga405550b28bd07884243fbd72adf2bade"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d01/a00227.html#ga8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d55/a00226.html#ga405550b28bd07884243fbd72adf2bade">picotm_shared_treemap_find_value</a> (struct <a class="el" href="../../dd/d86/a00271.html">picotm_shared_treemap</a> *self, unsigned long long key, <a class="el" href="../../dc/d55/a00226.html#ga1089f2dc42155ad95e7347fc1434c4d8">picotm_shared_treemap_value_create_function</a> value_create, <a class="el" href="../../dc/d55/a00226.html#ga818c239b617f13c2fb358c0217350c4d">picotm_shared_treemap_value_destroy_function</a> value_destroy, struct <a class="el" href="../../d6/d82/a00243.html">picotm_error</a> *error)</td></tr>
<tr class="separator:ga405550b28bd07884243fbd72adf2bade"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga641f1ee12b282a8e5445a33f80067c9b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d01/a00227.html#ga8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d55/a00226.html#ga641f1ee12b282a8e5445a33f80067c9b">picotm_shared_treemap_init</a> (struct <a class="el" href="../../dd/d86/a00271.html">picotm_shared_treemap</a> *self, unsigned long key_nbits, unsigned long level_nbits)</td></tr>
<tr class="separator:ga641f1ee12b282a8e5445a33f80067c9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga47644d7a13767c95af04d3d67a805136"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d01/a00227.html#ga8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d55/a00226.html#ga47644d7a13767c95af04d3d67a805136">picotm_shared_treemap_uninit</a> (struct <a class="el" href="../../dd/d86/a00271.html">picotm_shared_treemap</a> *self, <a class="el" href="../../dc/d55/a00226.html#ga818c239b617f13c2fb358c0217350c4d">picotm_shared_treemap_value_destroy_function</a> value_destroy)</td></tr>
<tr class="separator:ga47644d7a13767c95af04d3d67a805136"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The data stucture <code>struct <a class="el" href="../../dd/d86/a00271.html" title="Maps keys to values. ">picotm_shared_treemap</a></code> maps keys to values. Concurrent look-up by multiple transactions is supported. Keys can be up to 64 bit in length, values are of type <code>uintptr_t</code>, so unsigned integers or pointers can be stored.</p>
<p>Initialize a shared treemap with a call to <code><a class="el" href="../../dc/d55/a00226.html#ga641f1ee12b282a8e5445a33f80067c9b">picotm_shared_treemap_init()</a></code>.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="../../dc/d55/a00226.html#ga641f1ee12b282a8e5445a33f80067c9b">picotm_shared_treemap_init</a> treemap;</div><div class="line"><a class="code" href="../../dc/d55/a00226.html#ga641f1ee12b282a8e5445a33f80067c9b">picotm_shared_treemap_init</a>(&amp;treemap, 52, 13);</div></div><!-- fragment --><p>The second parameter is the maximum number of bits in a key. The initializer function sets up the shared treemap instance to support keys up to this length. Using larger keys is undefined. The third argument is the number of key bits handled per level of the internal tree hierarchy. Ideally this number is a remainder-free divider of the key length.</p>
<p>Call <code><a class="el" href="../../dc/d55/a00226.html#ga405550b28bd07884243fbd72adf2bade">picotm_shared_treemap_find_value()</a></code> to retrieve a key's value from the shared treemap. If the key/value pair is not in the shared treemap, a creator function can generate a new value as part of the lookup. If you don't provide a creator function, 0 is returned for non-existing values.</p>
<p>The following example returns the value for the key 0x1234 from the shared treemap, or inserts a new value if the key/value pair is not present.</p>
<div class="fragment"><div class="line"><span class="comment">// creator function</span></div><div class="line">uintptr_t</div><div class="line">create_value(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> key,</div><div class="line">             <span class="keyword">struct</span> <a class="code" href="../../dd/d86/a00271.html" title="Maps keys to values. ">picotm_shared_treemap</a>* treemap,</div><div class="line">             <span class="keyword">struct</span> <a class="code" href="../../d6/d82/a00243.html">picotm_error</a>* error)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span>* value = malloc(<span class="keyword">sizeof</span>(*value));</div><div class="line">    <span class="keywordflow">if</span> (!value) {</div><div class="line">        picotm_set_error_code(error, <a class="code" href="../../d9/d01/a00227.html#gga027f150be49120d8000153e2844b4544ac84324506cf33a843d157834707b38f1">PICOTM_OUT_OF_MEMORY</a>);</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line">    *value = 0;</div><div class="line">    <span class="keywordflow">return</span> (uintptr_t)value;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// destroy function</span></div><div class="line"><span class="keywordtype">void</span></div><div class="line">destroy_value(uintptr_t value, <span class="keyword">struct</span> <a class="code" href="../../dd/d86/a00271.html" title="Maps keys to values. ">picotm_shared_treemap</a>* treemap)</div><div class="line">{</div><div class="line">    free((<span class="keywordtype">int</span>*)value);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">struct </span><a class="code" href="../../d6/d82/a00243.html">picotm_error</a> error;</div><div class="line"><span class="keywordtype">int</span>* value = (<span class="keywordtype">int</span>*)<a class="code" href="../../dc/d55/a00226.html#ga405550b28bd07884243fbd72adf2bade">picotm_shared_treemap_find_value</a>(treemap, 0x1234,</div><div class="line">                                                    create_value,</div><div class="line">                                                    destroy_value,</div><div class="line">                                                    &amp;error);</div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="../../da/d45/a00011.html#a2b55a07e710ba43ea793a67e5e817b08">picotm_error_is_set</a>()) {</div><div class="line">    <span class="comment">// perform error recovery</span></div><div class="line">}</div></div><!-- fragment --><p>To uninitialize a shared treemap, call <code><a class="el" href="../../dc/d55/a00226.html#ga47644d7a13767c95af04d3d67a805136">picotm_shared_treemap_uninit()</a></code>. This function requires a destroy function for the values. It walk over all keys in the shared treemap and invokes the destroy function on each key's value.</p>
<div class="fragment"><div class="line"><a class="code" href="../../dc/d55/a00226.html#ga47644d7a13767c95af04d3d67a805136">picotm_shared_treemap_uninit</a>(&amp;treemap, destroy_value);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<!--
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
-->
</body>
</html>
