<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>picotm: include/picotm/picotm.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_5b80beafa98edb674d077381aed44f4f.html">include</a></li><li class="navelem"><a class="el" href="../../dir_4eaf8f6a41a8424231482edc717c057f.html">picotm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">picotm.h File Reference<div class="ingroups"><a class="el" href="../../d4/d1e/a00497.html">The picotm Programming Interface</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Main header file for picotm.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;picotm/config/picotm-config.h&gt;</code><br />
<code>#include &lt;setjmp.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../dd/dad/a00005.html">compiler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/dee/a00008.html">picotm-error.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:acc4de35068696187a89ba73ff54f2c82"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#acc4de35068696187a89ba73ff54f2c82">picotm_begin</a></td></tr>
<tr class="separator:acc4de35068696187a89ba73ff54f2c82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2a3ff1fd64dd3038cb3e863da12f1c9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#aa2a3ff1fd64dd3038cb3e863da12f1c9">picotm_commit</a></td></tr>
<tr class="separator:aa2a3ff1fd64dd3038cb3e863da12f1c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc10340471b96a797fbf6610341bbe01"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#acc10340471b96a797fbf6610341bbe01">picotm_end</a></td></tr>
<tr class="separator:acc10340471b96a797fbf6610341bbe01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a449c1a4ff44201a422c2594ae1a82076"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#a449c1a4ff44201a422c2594ae1a82076">picotm_safe</a></td></tr>
<tr class="separator:a449c1a4ff44201a422c2594ae1a82076"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a997121ceed6277b7ef69dbad1aa68086"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#a997121ceed6277b7ef69dbad1aa68086">picotm_error_as_errno</a> (void)</td></tr>
<tr class="separator:a997121ceed6277b7ef69dbad1aa68086"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0403e0b93b3866fda5fe11dd852e2d9d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> enum <a class="el" href="../../d4/dee/a00008.html#a027f150be49120d8000153e2844b4544">picotm_error_code</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#a0403e0b93b3866fda5fe11dd852e2d9d">picotm_error_as_error_code</a> (void)</td></tr>
<tr class="separator:a0403e0b93b3866fda5fe11dd852e2d9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6359f5ff0c953851e6e84ec6697096d2"><td class="memItemLeft" align="right" valign="top">kern_return_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#a6359f5ff0c953851e6e84ec6697096d2">picotm_error_as_kern_return_t</a> (void)</td></tr>
<tr class="separator:a6359f5ff0c953851e6e84ec6697096d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dc297a774d2baa76062d6c333b87ec6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#a2dc297a774d2baa76062d6c333b87ec6">picotm_error_is_non_recoverable</a> (void)</td></tr>
<tr class="separator:a2dc297a774d2baa76062d6c333b87ec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8bdacce12bec19231544ac739de3405"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> enum <a class="el" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342e">picotm_error_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#ac8bdacce12bec19231544ac739de3405">picotm_error_status</a> ()</td></tr>
<tr class="separator:ac8bdacce12bec19231544ac739de3405"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec5abc7ec9784e159c055e7ccba50db"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#a6ec5abc7ec9784e159c055e7ccba50db">picotm_number_of_restarts</a> (void)</td></tr>
<tr class="separator:a6ec5abc7ec9784e159c055e7ccba50db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a271edb9dbe9f7bf939184bcc6ecd41b7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#a271edb9dbe9f7bf939184bcc6ecd41b7">picotm_release</a> (void)</td></tr>
<tr class="separator:a271edb9dbe9f7bf939184bcc6ecd41b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4caaf20fc37108f33c8c08bf8ea1d51"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html#ad4caaf20fc37108f33c8c08bf8ea1d51">picotm_restart</a> (void)</td></tr>
<tr class="separator:ad4caaf20fc37108f33c8c08bf8ea1d51"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is the main header file for picotm. It contains the entry points for starting, committing and ending a transaction; for restarting, and for error handling. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="acc4de35068696187a89ba73ff54f2c82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc4de35068696187a89ba73ff54f2c82">&#9670;&nbsp;</a></span>picotm_begin</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define picotm_begin</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Starts a new transaction.</p>
<p>Invoking <a class="el" href="../../d7/db6/a00940.html#acc4de35068696187a89ba73ff54f2c82">picotm_begin</a> starts a new transaction. Any code between this macro and <a class="el" href="../../d7/db6/a00940.html#aa2a3ff1fd64dd3038cb3e863da12f1c9">picotm_commit</a> is considered part of the transaction's execution phase. If the transaction aborts, it will restart from where the <a class="el" href="../../d7/db6/a00940.html#acc4de35068696187a89ba73ff54f2c82">picotm_begin</a> had been invoked. </p>

</div>
</div>
<a id="aa2a3ff1fd64dd3038cb3e863da12f1c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2a3ff1fd64dd3038cb3e863da12f1c9">&#9670;&nbsp;</a></span>picotm_commit</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define picotm_commit</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Commits the current transaction.</p>
<p>This macro commits the currently running transaction. Picotm will validate the consistency of all of the transaction's resources and, if successful, apply all outstanding operations. If validation fails, the transaction will be restarted from <a class="el" href="../../d7/db6/a00940.html#acc4de35068696187a89ba73ff54f2c82">picotm_begin</a>.</p>
<dl class="section attention"><dt>Attention</dt><dd>Calling this macro is only valid <em>after</em> <a class="el" href="../../d7/db6/a00940.html#acc4de35068696187a89ba73ff54f2c82">picotm_begin</a> and <em>before</em> <a class="el" href="../../d7/db6/a00940.html#acc10340471b96a797fbf6610341bbe01">picotm_end</a>. </dd></dl>

</div>
</div>
<a id="acc10340471b96a797fbf6610341bbe01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc10340471b96a797fbf6610341bbe01">&#9670;&nbsp;</a></span>picotm_end</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define picotm_end</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Ends the current transaction. </p>

</div>
</div>
<a id="a449c1a4ff44201a422c2594ae1a82076"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a449c1a4ff44201a422c2594ae1a82076">&#9670;&nbsp;</a></span>picotm_safe</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define picotm_safe</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Marks a non-transactional variable in a function.</p>
<p>When restarting a transaction, picotm uses non-local goto, based on the <code>sigjmp()</code> and <code>longjmp()</code> functions provided by the C Standard Library. These functions save and restore the thread's instruction and stack pointer, but don't save any variables. This can result in program errors if a variable is held in a register that changes its value between invocations of <code>sigjmp()</code> and <code>longjmp()</code>. The call to <code>longjmp()</code> will not restore the variable's original value.</p>
<p>To avoid this problem, mark local, non-transactional variables with <a class="el" href="../../d7/db6/a00940.html#a449c1a4ff44201a422c2594ae1a82076">picotm_safe</a> as shown below.</p>
<div class="fragment"><div class="line"><a class="code" href="../../d7/db6/a00940.html#a449c1a4ff44201a422c2594ae1a82076">picotm_safe</a> <span class="keywordtype">int</span> var = 0;</div><div class="line"></div><div class="line"><a class="code" href="../../d7/db6/a00940.html#acc4de35068696187a89ba73ff54f2c82">picotm_begin</a></div><div class="line"></div><div class="line">    [...]</div><div class="line"></div><div class="line"><a class="code" href="../../d7/db6/a00940.html#aa2a3ff1fd64dd3038cb3e863da12f1c9">picotm_commit</a></div><div class="line"></div><div class="line"><a class="code" href="../../d7/db6/a00940.html#acc10340471b96a797fbf6610341bbe01">picotm_end</a></div></div><!-- fragment --><p>Even with <a class="el" href="../../d7/db6/a00940.html#a449c1a4ff44201a422c2594ae1a82076">picotm_safe</a>, you still have to privatize the variable when using it within the transaction.</p>
<p>With gcc, the command-line option '-Wclobbered' enables a warning about this problem. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a997121ceed6277b7ef69dbad1aa68086"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a997121ceed6277b7ef69dbad1aa68086">&#9670;&nbsp;</a></span>picotm_error_as_errno()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> int picotm_error_as_errno </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the current picotm errno code.</p>
<dl class="section attention"><dt>Attention</dt><dd>This function is only valid during the transaction's recovery phase, and if <a class="el" href="../../d7/db6/a00940.html#ac8bdacce12bec19231544ac739de3405">picotm_error_status()</a> is <a class="el" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342ea2845cde18d3b63d65fe77fc9f847eb84">PICOTM_ERRNO</a>.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The current picotm errno code. </dd></dl>

</div>
</div>
<a id="a0403e0b93b3866fda5fe11dd852e2d9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0403e0b93b3866fda5fe11dd852e2d9d">&#9670;&nbsp;</a></span>picotm_error_as_error_code()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> enum <a class="el" href="../../d4/dee/a00008.html#a027f150be49120d8000153e2844b4544">picotm_error_code</a> picotm_error_as_error_code </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the current picotm error code.</p>
<dl class="section attention"><dt>Attention</dt><dd>This function is only valid during the transaction's recovery phase, and if <a class="el" href="../../d7/db6/a00940.html#ac8bdacce12bec19231544ac739de3405">picotm_error_status()</a> is <a class="el" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342ea7a4ec77d7044942ef4fbcb2c8e0c1af0">PICOTM_ERROR_CODE</a>.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The current picotm error code. </dd></dl>

</div>
</div>
<a id="a6359f5ff0c953851e6e84ec6697096d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6359f5ff0c953851e6e84ec6697096d2">&#9670;&nbsp;</a></span>picotm_error_as_kern_return_t()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kern_return_t picotm_error_as_kern_return_t </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the current picotm kern_return_t value.</p>
<dl class="section attention"><dt>Attention</dt><dd>This function is only valid during the transaction's recovery phase, and if <a class="el" href="../../d7/db6/a00940.html#ac8bdacce12bec19231544ac739de3405">picotm_error_status()</a> is <a class="el" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342ead02b9af0bb7debe151b4e716e87bf428">PICOTM_KERN_RETURN_T</a>.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The current picotm kern_return_t value. </dd></dl>

</div>
</div>
<a id="a2dc297a774d2baa76062d6c333b87ec6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dc297a774d2baa76062d6c333b87ec6">&#9670;&nbsp;</a></span>picotm_error_is_non_recoverable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> bool picotm_error_is_non_recoverable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the current error's recoverable status.</p>
<dl class="section attention"><dt>Attention</dt><dd>This function is only valid during the transaction's recovery phase.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The current error status. </dd></dl>

</div>
</div>
<a id="ac8bdacce12bec19231544ac739de3405"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8bdacce12bec19231544ac739de3405">&#9670;&nbsp;</a></span>picotm_error_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> enum <a class="el" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342e">picotm_error_status</a> <a class="el" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342e">picotm_error_status</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the current error status.</p>
<dl class="section attention"><dt>Attention</dt><dd>This function is only valid during the transaction's recovery phase.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The current error status. </dd></dl>

</div>
</div>
<a id="a6ec5abc7ec9784e159c055e7ccba50db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ec5abc7ec9784e159c055e7ccba50db">&#9670;&nbsp;</a></span>picotm_number_of_restarts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> unsigned long picotm_number_of_restarts </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the number of restarts of the thread's most recent transaction. </p>

</div>
</div>
<a id="a271edb9dbe9f7bf939184bcc6ecd41b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a271edb9dbe9f7bf939184bcc6ecd41b7">&#9670;&nbsp;</a></span>picotm_release()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> void picotm_release </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Releases all resources of picotm on the current thread. </p>

</div>
</div>
<a id="ad4caaf20fc37108f33c8c08bf8ea1d51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4caaf20fc37108f33c8c08bf8ea1d51">&#9670;&nbsp;</a></span>picotm_restart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/dad/a00005.html#a8925df8a78b66febc94f920b197a1f6e">PICOTM_NOTHROW</a> void picotm_restart </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Restarts the current transaction. </p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<!--
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
-->
</body>
</html>
