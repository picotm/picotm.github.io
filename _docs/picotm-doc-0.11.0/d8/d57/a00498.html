<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>picotm: The Type-Casting Module</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">The Type-Casting Module</div>  </div>
</div><!--header-->
<div class="contents">

<p>The type-casting module provides safe casting between C types. Overflows or underflows in the destination type's range are reported as errors to the transaction.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:d5/de0/a00050"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de0/a00050.html">picotm-cast-ctypes.h</a></td></tr>
<tr class="memdesc:d5/de0/a00050"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transactional, safe type casting for native C types. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:dc/dee/a00053"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/dee/a00053.html">picotm-cast.h</a></td></tr>
<tr class="memdesc:dc/dee/a00053"><td class="mdescLeft">&#160;</td><td class="mdescRight">Public interfaces of picotm's type-casting module. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The type-casting module provides safe casting between C types. Type casting is subject to overflows or underflows of the destination type's range. For example, casting the value of <em>512</em> from 16-bit-wide <code>short</code> to 8-bit-wide <code>signed char</code> overflows the range of <code>signed char</code>. Similarly, casting from signed to unsigned types underflows the destination type's range if the source value is negative.</p>
<p>All type-casting functions are in the form of <code>cast_&lt;source type&gt;_to_&lt;destination type&gt;_tx()</code>, where <code>&lt;source type&gt;</code> and <code>&lt;destination type&gt;</code> are names for C types. Each function takes a value of the source type and returns the same value casted to the destination type.</p>
<p>Picotm's type-casting module comes with pre-defined functions for converting between all C-native integer types, and for converting from C-native integer to floating-point types. Here's an example transaction that casts a value from <code>long</code> to <code>int</code>.</p>
<div class="fragment"><div class="line"><a class="code" href="../../d7/db6/a00940.html#acc4de35068696187a89ba73ff54f2c82">picotm_begin</a></div><div class="line">    <span class="keywordtype">int</span> dst = <a class="code" href="../../d5/de0/a00050.html#a4435349baa09e4efa3a8838fda736a5f">cast_long_to_int_tx</a>(LONG_MAX);</div><div class="line"><a class="code" href="../../d7/db6/a00940.html#aa2a3ff1fd64dd3038cb3e863da12f1c9">picotm_commit</a></div><div class="line">    <span class="keywordflow">if</span> ((<a class="code" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342e">picotm_error_status</a>() == <a class="code" href="../../d4/dee/a00008.html#a7793e31c9b070a4be6f5747c5b43342ea2845cde18d3b63d65fe77fc9f847eb84">PICOTM_ERRNO</a>) &amp;&amp;</div><div class="line">        (<a class="code" href="../../d7/db6/a00940.html#a997121ceed6277b7ef69dbad1aa68086">picotm_error_as_errno</a>() == ERANGE)) {</div><div class="line">        <span class="comment">// An error happened during type casting.</span></div><div class="line">    }</div><div class="line"><a class="code" href="../../d7/db6/a00940.html#acc10340471b96a797fbf6610341bbe01">picotm_end</a></div></div><!-- fragment --><p>Depending on the system's architecture, type <code>long</code> is either 32 bit of 64 bit in size. The example succeeds on 32-bit systems but reports an error on 64-bit systems.</p>
<p>The C preprocessor macro <code><a class="el" href="../../dc/dee/a00053.html#a5dbf326a220abb12f614eaca0068546b">PICOTM_CAST_TX()</a></code> creates a cast function for a specific pair of types and limits. We can use it to define cast functions for application-specific types. All pre-defined conversion function are created with this macro, so casts for application types share the same behaviour and features.</p>
<p>For example, our application might define the floating-point type <code>float100</code>, which is only defined from minus 100 to plus 100.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> float100;</div><div class="line"></div><div class="line"><span class="preprocessor">#define FLT100_MAX  100     // similar to FLT_MAX from &lt;float.h&gt;</span></div></div><!-- fragment --><p>We can now create a function for casting from float to float100 using <code><a class="el" href="../../dc/dee/a00053.html#a5dbf326a220abb12f614eaca0068546b">PICOTM_CAST_TX()</a></code>.</p>
<div class="fragment"><div class="line"><a class="code" href="../../dc/dee/a00053.html#a5dbf326a220abb12f614eaca0068546b">PICOTM_CAST_TX</a>(<span class="keywordtype">float</span>, <span class="keywordtype">float</span>, float100, float100, -FLT100_MAX, FLT100_MAX);</div></div><!-- fragment --><p>This macro expands to a function that casts from type <code>float</code> to type <code>float100</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> float100</div><div class="line">cast_float_to_float100_tx(<span class="keywordtype">float</span> value)</div><div class="line">{</div><div class="line">    ... <span class="comment">// safe type-casting code</span></div><div class="line">}</div></div><!-- fragment --><p>The return value of this function is of type <code>float100</code> and spans values between <code>-FLT_MAX</code> and <code>FLT_MAX</code>, which has been defined to <code>100</code>. If the parameter overflows or underflows this range, the function signals <code>ERANGE</code> to the transaction's recovery code.</p>
<p>Similarly, we can define a function for casting from <code>unsigned char</code> to <code>float100</code>.</p>
<div class="fragment"><div class="line"><a class="code" href="../../dc/dee/a00053.html#a5dbf326a220abb12f614eaca0068546b">PICOTM_CAST_TX</a>(uchar, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>, float100, float100, -FLT100_MAX, FLT100_MAX);</div></div><!-- fragment --><p>This expands to the function shown below. Note that we used <em>uchar</em> for function names that involve <code>unsigned char</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> float100</div><div class="line">cast_uchar_to_float100_tx(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> value)</div><div class="line">{</div><div class="line">    ... <span class="comment">// safe type-casting code</span></div><div class="line">}</div></div><!-- fragment --><p>We can also cast from <code>float100</code> to another type. The cast's minimum and maximum values are always relative to the destination type. So for a cast from <code>float100</code> to <code>unsigned char</code> we have to use <code>0</code> and <code>UCHAR_MAX</code> as the limits.</p>
<div class="fragment"><div class="line"><a class="code" href="../../dc/dee/a00053.html#a5dbf326a220abb12f614eaca0068546b">PICOTM_CAST_TX</a>(float100, float100, uchar, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>, 0, UCHAR_MAX);</div></div><!-- fragment --><p>Conversions from floating-point to integer types are not supported by the type-casting module, as they involve floating-point rounding modes. Transactional conversion functions from picotm's C Math Library module perform such operations.</p>
<p>Also not supported by the type-casting module are conversions from and to C strings. The <code><a class="el" href="../../db/dab/a00089.html#a1ed11a718f743571008c82dc2ee27508">sscanf_tx()</a></code> and <code><a class="el" href="../../db/dab/a00089.html#a1d9d4fe19e0831c1c3256a590c8d8d1f">snprintf_tx()</a></code> families of functions from picotm's C Standard Library Module perform these operations.</p>
<p>Results or parameters of type-casting operations should be loaded into the transaction or stored from the transaction using the Transactional memory module. </p>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<!--
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
-->
</body>
</html>
